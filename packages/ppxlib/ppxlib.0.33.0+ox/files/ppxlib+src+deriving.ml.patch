--- a/src/deriving.ml
+++ b/src/deriving.ml
@@ -257,11 +257,11 @@ module Deriver = struct
       str_module_type_decl :
         (structure, module_type_declaration) Generator.t option;
       sig_type_decl :
-        (signature, rec_flag * type_declaration list) Generator.t option;
-      sig_type_ext : (signature, type_extension) Generator.t option;
-      sig_exception : (signature, type_exception) Generator.t option;
+        (signature_item list, rec_flag * type_declaration list) Generator.t option;
+      sig_type_ext : (signature_item list, type_extension) Generator.t option;
+      sig_exception : (signature_item list, type_exception) Generator.t option;
       sig_module_type_decl :
-        (signature, module_type_declaration) Generator.t option;
+        (signature_item list, module_type_declaration) Generator.t option;
       extension :
         (loc:Location.t -> path:string -> core_type -> expression) option;
     }
@@ -587,7 +587,7 @@ let mk_deriving_attr context ~prefix ~su
                  (map1 (many __) ~f:parse_arguments))
       in
       let generators =
-        pexp_tuple (many (generator ()))
+        (pexp_tuple (many (generator ())))
         ||| map (generator ()) ~f:(fun f x -> f [ x ])
       in
       pstr (pstr_eval generators nil ^:: nil))
@@ -679,7 +679,7 @@ let wrap_sig ~loc ~hide ~unused_code_war
   let warnings =
     if
       keep_w60_intf ()
-      || (not (Ignore_unused_warning.binds_module_names#signature sg false))
+      || (not (Ignore_unused_warning.binds_module_names#signature_items sg false))
       || unused_code_warnings
     then warnings
     else 60 :: warnings
@@ -700,11 +700,21 @@ let wrap_sig ~loc ~hide list =
    | Main expansion                                                  |
    +-----------------------------------------------------------------+ *)
 
+let remove_attributes =
+  object
+    inherit Ast_traverse0.map
+
+    method! attributes _ = []
+  end
+;;
+
 let types_used_by_deriving (tds : type_declaration list) : structure_item list =
   if keep_w32_impl () then []
   else
     List.map tds ~f:(fun td ->
-        let typ = Common.core_type_of_type_declaration td in
+        (* TODO: Stop removing attributes, and fix [deriving_inline] so it doesn't result
+           in unused attribute errors when adding e.g. [let _ = fun (_ : t[@x]) -> ()] *)
+        let typ = remove_attributes#core_type (Common.core_type_of_type_declaration td) in
         let loc = td.ptype_loc in
         pstr_value ~loc Nonrecursive
           [
